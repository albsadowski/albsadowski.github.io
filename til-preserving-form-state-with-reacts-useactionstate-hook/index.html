<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="albert's blog"><link rel="shortcut icon" href=https://albsadowski.github.io/favicon.ico><link rel=stylesheet href=/css/style.min.css><link rel=canonical href=https://albsadowski.github.io/til-preserving-form-state-with-reacts-useactionstate-hook/><title>TIL: Preserving Form State with React's useActionState Hook</title></head><body><header id=banner><h2><a href=https://albsadowski.github.io/>albert's blog</a></h2><nav><ul><li><a href=/ title=posts>posts</a></li><li><a href=/publications/ title=publications>publications</a></li><li><a href=/about/ title=about>about</a></li></ul></nav></header><main id=content><article><header id=post-header><h1>TIL: Preserving Form State with React's useActionState Hook</h1><div><time>March 1, 2025</time></div></header><p>React recently introduced the <a href=https://react.dev/reference/react/useActionState><code>useActionState</code></a> hook, and while the official docs provide basic examples, I immediately wanted to tackle a common real-world scenario: preserving form input values after submission errors.</p><h2 id=the-problem>The Problem</h2><p>When a user submits a form with invalid credentials, we typically want to:</p><ol><li>Show an error message</li><li>Preserve what they&rsquo;ve already typed (especially for multi-field forms)</li></ol><p>Without this, users face the frustration of re-typing information they&rsquo;ve already entered.</p><h2 id=traditional-approach>Traditional Approach</h2><p>The traditional approach requires maintaining controlled components with <code>onChange</code> handlers:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>SignInForm</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>email</span>, <span style=color:#a6e22e>setEmail</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>useState</span>(<span style=color:#e6db74>&#39;&#39;</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>password</span>, <span style=color:#a6e22e>setPassword</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>useState</span>(<span style=color:#e6db74>&#39;&#39;</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>error</span>, <span style=color:#a6e22e>setError</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>useState</span>(<span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>handleSubmit</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>e</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>preventDefault</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>signIn</span>(<span style=color:#a6e22e>email</span>, <span style=color:#a6e22e>password</span>)
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>err</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>setError</span>(<span style=color:#e6db74>&#39;Invalid credentials&#39;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>form</span> <span style=color:#a6e22e>onSubmit</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>handleSubmit</span>}&gt;
</span></span><span style=display:flex><span>      {<span style=color:#a6e22e>error</span> <span style=color:#f92672>&amp;&amp;</span> &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;error&#34;</span>&gt;{<span style=color:#a6e22e>error</span>}&lt;/<span style=color:#f92672>div</span>&gt;}
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>input</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;email&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>email</span>}
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>onChange</span><span style=color:#f92672>=</span>{(<span style=color:#a6e22e>e</span>) =&gt; <span style=color:#a6e22e>setEmail</span>(<span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>target</span>.<span style=color:#a6e22e>value</span>)}
</span></span><span style=display:flex><span>      /&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>input</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;password&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>password</span>}
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>onChange</span><span style=color:#f92672>=</span>{(<span style=color:#a6e22e>e</span>) =&gt; <span style=color:#a6e22e>setPassword</span>(<span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>target</span>.<span style=color:#a6e22e>value</span>)}
</span></span><span style=display:flex><span>      /&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;submit&#34;</span>&gt;<span style=color:#a6e22e>Sign</span> <span style=color:#a6e22e>In</span>&lt;/<span style=color:#f92672>button</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>form</span>&gt;
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=the-useactionstate-approach>The <code>useActionState</code> Approach</h2><p>With <code>useActionState</code>, we can achieve the same result with less code and without tracking intermediate states:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#e6db74>&#39;use server&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>signInAction</span>(<span style=color:#a6e22e>prevState</span>, <span style=color:#a6e22e>formData</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>email</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>formData</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;email&#39;</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>password</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>formData</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;password&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>signIn</span>(<span style=color:#a6e22e>email</span>, <span style=color:#a6e22e>password</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> { <span style=color:#a6e22e>success</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span> }
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> { 
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>email</span>, 
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>error</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Invalid credentials&#39;</span> 
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>useActionState</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;react&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>SignInForm</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>state</span>, <span style=color:#a6e22e>formAction</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>useActionState</span>(<span style=color:#a6e22e>signInAction</span>, {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// initial state
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>state</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>success</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> &lt;<span style=color:#f92672>div</span>&gt;<span style=color:#a6e22e>You</span><span style=color:#e6db74>&#39;re signed in!&lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  return (
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;form action={formAction}&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      {state?.error &amp;&amp; &lt;div className=&#34;error&#34;&gt;{state.error}&lt;/div&gt;}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &lt;input
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        type=&#34;email&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        name=&#34;email&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        defaultValue={state?.email || &#39;</span><span style=color:#960050;background-color:#1e0010>&#39;</span>}
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>required</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>input</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;password&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;password&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>required</span>
</span></span><span style=display:flex><span>      /&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;submit&#34;</span>&gt;<span style=color:#a6e22e>Sign</span> <span style=color:#a6e22e>In</span>&lt;/<span style=color:#f92672>button</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>form</span>&gt;
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The key part is to set the <em>defaultValue</em> on the <em>input</em>.</p><p>In particular, I&rsquo;m a fan on letting the native components do its job. Historically, React (or people using React) used to track every piece of state - think of the state of <em>input</em>, kept in <em>state</em> and tracked with <em>onChange</em>. I&rsquo;m happy with the paradigm shift.</p></article></main><footer id=footer>Copyright © 2025 Albert Sadowski</footer></body></html>