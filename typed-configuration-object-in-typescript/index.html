<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="albert's blog"><link rel="shortcut icon" href=https://albsadowski.github.io/favicon.ico><link rel=stylesheet href=/css/style.min.css><link rel=canonical href=https://albsadowski.github.io/typed-configuration-object-in-typescript/><title>Typed Configuration Object in TypeScript</title></head><body><header id=banner><h2><a href=https://albsadowski.github.io/>albert's blog</a></h2><nav><ul><li><a href=/ title=posts>posts</a></li><li><a href=/research/ title=research>research</a></li><li><a href=/about/ title=about>about</a></li></ul></nav></header><main id=content><article><header id=post-header><h1>Typed Configuration Object in TypeScript</h1><div><time>July 16, 2023</time></div></header><h2 id=compile-time-vs-runtime-in-typescript>Compile-Time vs Runtime in TypeScript</h2><p><em>TypeScript</em> is an amazing technology, but it has been build under the assumption is compiles down to <em>JavaScript</em>. As a consequence, all the wonderful types one can enjoy during the compile time, are completely gone during the runtime. Thus, it&rsquo;s crucial to validate all the data from the IO.</p><p>As the types doesn&rsquo;t leave us any information about the data at the runtime, we usually end up maintaining two definitions of the same: (1) the class/interface for the typing purposes (2) JSON schema for validation purposes.</p><p>There are many libraries/attempts to help with the problem, but my favourite is <a href=https://ajv.js.org/>Ajv</a>. Ajv can work as a standard JSON schema validation tool, but it has a superpower of making the <a href=https://ajv.js.org/json-schema.html>JSON Schema</a>/<a href=https://ajv.js.org/json-type-definition.html>JSON Type Definition</a> visible to TypeScript, i.e., from the JSON Schema/Type Def defined in the codebase, Ajv can transform that object into a TypeScript <code>type</code> at the compile-time, e.g.:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>JTDDataType</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;ajv/dist/jtd&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>FooSchema</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>properties</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>foo</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;string&#34;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>const</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Foo</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>JTDDataType</span>&lt;<span style=color:#f92672>typeof</span> <span style=color:#a6e22e>FooSchema</span>&gt;
</span></span></code></pre></div><p>The <code>FooSchema</code> definition can be used for the actual validation, and the <code>Foo</code> is a type definition we can use in our codebase, thus we don&rsquo;t need an additional <code>interface</code>/<code>class</code> re-definition.</p><h2 id=using-ajv-for-configuration-object>Using Ajv for Configuration Object</h2><p>When writing a nodejs application, one of the first dynamically typed pieces of information to deal with is configuration. We either load from a file, environment or maybe a secrets manager, but it&rsquo;s all guaranteed to be untyped by default.</p><p>With Ajv, one can define a configuration schema, leverage that for validation purposes and use the magic of type transformation to get the typings for the schema.</p><p>As there&rsquo;s some boilerplate around reading files/environment, I ended up extracing that into a small, Ajv-based, library <a href=https://github.com/albsadowski/config>@dumpstate/config</a>.</p><p>From now on, when I deal with configuration in nodejs, my code looks as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>ConfigSchemaType</span>, <span style=color:#a6e22e>loadConfig</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@dumpstate/config&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// NB I prefer JSON Type Definition
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>ConfigSchema</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>properties</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>app</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>properties</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>host</span><span style=color:#f92672>:</span> { <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;string&#34;</span> },
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>port</span><span style=color:#f92672>:</span> { <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;int32&#34;</span> },
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>const</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// NB ConfigSchemaType is just convenience proxy to JTDDataType from Ajv
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Config</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>ConfigSchemaType</span>&lt;<span style=color:#f92672>typeof</span> <span style=color:#a6e22e>ConfigSchema</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// NB config is of `Config` type - both typed and validated
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>config</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>loadConfig</span>(<span style=color:#a6e22e>ConfigSchema</span>, { <span style=color:#a6e22e>appName</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;foo&#34;</span> })
</span></span></code></pre></div><p><code>loadConfig</code> supports two configuration loaders (in the order of loading):</p><ol><li>file configuration loader:</li></ol><ul><li>loads <code>config/default.application.json</code>,</li><li>loads <code>config/application.json</code>,</li><li>loads any file provided as <code>APPLICATION_CONFIG</code> environment variable.</li></ul><ol start=2><li>environment configuration loader:</li></ol><ul><li>expects environment variables in the format e.g., <code>${appName}__APP__HOST</code>, where the <code>appName</code> is the name of the application passed to the <code>loadConfig</code>, then all <code>.</code> on the JSON path are transformed into <code>__</code> and camel cased properties are snake cased.</li></ul><h2 id=links>Links</h2><ol><li><a href=https://ajv.js.org/>Ajv</a></li><li><a href=https://github.com/albsadowski/config>@dumpstate/config</a></li></ol></article></main><footer id=footer>Copyright Â© 2025 Albert Sadowski</footer></body></html>